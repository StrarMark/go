#### 2PC

两阶段提交是指将提交过程分为两个阶段，即准备阶段（投票阶段）和提交阶段（执行阶段）。

准备阶段：事务管理器向每个资源管理器发送准备消息。如果资源管理器的本地事务操作执行成功，则返回成功；如果本地事务操作执行失败，则返回失败。

提交阶段：如果事务管理器收到了所有资源管理器回复的成功消息，则向每个资源管理器发送提交消息；否则发送回滚消息。

两阶段提交协议是一个阻塞协议，如果事务的执行过程中事务管理器宕机，事务的一部分参与者将永远无法完成事务，它们会等待协调者发送 COMMIT 或者 ROLLBACK 消息，甚至会出现多个参与者状态不一致的问题。

#### 3PC

为了解决两阶段提交在协议的一些问题，三阶段提交引入了超时机制和准备阶段，如果协调者或者参与者在规定的之间内没有接受到来自其他节点的响应，就会根据当前的状态选择提交或者终止整个事务。

准备阶段的引入其实让事务的参与者有了除回滚之外的其他选择。

![](https://img.draveness.me/2018-08-14-Three-phase_commit_diagram.png)

当参与者向协调者发送 ACK 后，如果长时间没有得到协调者的响应，在默认情况下，参与者会自动将超时的事务进行提交，不会像两阶段提交中被阻塞住。

#### TCC

TCC 分布式事务模型需要业务系统提供三段业务逻辑：
 
 1. 初步操作 Try：完成所有业务检查，预留必须的业务资源
 2. 确认操作 Confirm：真正执行的业务逻辑，不作任何业务检查，只使用 Try 阶段预留的业务资源。因此，只要 Try 操作成功，Confirm 必须能成功。另外，Confirm 操作需满足幂等性，保证一笔分布式事务有且只能成功一次。
 3. 取消操作 Cancel：释放 Try 阶段预留的业务资源。同样的，Cancel 操作也需要满足幂等性。

业务接入需要实现 Try、Confirm、Cancel 三个接口，定制化程度高，开发成本高。

参考：

[分布式事务的实现原理](https://draveness.me/distributed-transaction-principle/) <br>
[微服务中的分布式事务方案](https://jeremyxu2010.github.io/2020/03/%E5%BE%AE%E6%9C%8D%E5%8A%A1%E4%B8%AD%E7%9A%84%E5%88%86%E5%B8%83%E5%BC%8F%E4%BA%8B%E5%8A%A1%E6%96%B9%E6%A1%88/#heading-3) <br>
[一篇文章带你学习分布式事务](https://www.infoq.cn/article/g1avp9fua6cdoyralv4r) <br>
[分布式事务 三阶段提交 (3PC)](https://juejin.cn/post/6844903960432623623) <br>