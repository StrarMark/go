优惠券相信大家在各大电商网站购物的时候都用过，有的时候领了一张券会想法设法的挑选商品来达到优惠券的使用金额，哪怕买了预期之外的商品也要把这张券用掉，褥羊毛的心态大部分人都有。

从产品的角度思考类似优惠券这种营销活动正是抓住了用户褥羊毛的心态，促进用户消费来增加商品的销量，从而赚取更多的利益。现在很多类电商产品在你注册之后会时不时的给你发一张券，当你有需求时还是很乐意去 app 上面买东西的，这样你就从一个新用户慢慢变成了老用户，这对很多产品来说都是非常重要的。

最近一段时间也是接触了营销优惠券相关的业务，我所处的情况比较复杂 ，公司正经历 C 端业务由 PHP 切到 Java 的过程，优惠券相关业务以前是 PHP 做的，需要全部切成 Java，除了需要保证功能可用还要完成数据转化，当用户由老版本升级到新版本，整个过程是无感知的。接下来我主要从优惠券需求分析、优惠券业务现状、需求迁移设计、数据迁移与未来需求优化几个方面谈谈最近的感受与收获。

### 一、优惠券需求分析

#### 1.1 优惠券模型

![](https://raw.githubusercontent.com/zchen96/java-memo/master/image/%E4%B8%9A%E5%8A%A1/1.%E4%BC%98%E6%83%A0%E5%88%B8%E5%9F%BA%E6%9C%AC%E6%A8%A1%E5%9E%8B.png)

一个完整的优惠券信息可以理解为一套规则的组合，主要包括以下几点：基本信息、优惠券类型、优惠券业务类型、有效期、使用范围等。可以结合自己的业务场景调整。

- 基本信息：优惠券的基本信息主要有优惠券的名字，发放数量，每人限制领取数量，规则描述等
- 优惠券类型：满减券、折扣券等
- 优惠券业务类型：这个业务类型可以根据产品的定位考虑是否需要，比如我们是医疗相关的产品，会售卖一些服务与商城商品，因此我们就有商城与服务两种业务类型的券
- 有效期：有效期一般有两种，固定时间段与设置固定有效天数
- 适用范围：全部商品可用、制定商品分类可用、指定商品可用等

#### 1.2 优惠券活动

![](https://raw.githubusercontent.com/zchen96/java-memo/master/image/%E4%B8%9A%E5%8A%A1/2.%E4%BC%98%E6%83%A0%E5%88%B8%E6%B4%BB%E5%8A%A8.png)

上面梳理的优惠券模型只是一个模板，并不具备活动信息，因此一个优惠券模板并不具备发放资格，一般我们会搞一个专题活动页，点进去是一张或者多张优惠券，活动一般有开始与结束时间、活动状态、图片、链接等信息。活动创建完成后对优惠券与活动进行关联，优惠券发放更灵活，无论从产品还是开发角度都更容易理解。


#### 1.3 发券方式

一个用户获取优惠券的方式有很多种：

- 专题活动页面手动领取
- 注册或者进入 APP 主页系统以弹窗形式自动发放
- 精准营销，以任务的形式给某些用户群体发放，通过短信或者 push 推送告知用户
- 分享领券，比如我们常用的外卖软件，分享后自己与他人皆可领券
- 后台手动给指定用户发放（后门）

#### 1.4 下单流程

下面主要从开发的角度来分析，用户选购商品在下单时需要获取所有可用优惠券（达到满减金额、指定商品等条件），默认选中对用户最优惠的，如果业务复杂这里还需要考虑多优惠券互斥情况。

用户领取的优惠券一般有未使用，已使用，已过期几个状态，当下单使用了一张优惠券时，这张优惠券的状态应该怎么设置，因为用户下单并不意味着会支持，订单可能会被用户取消，也可能是因为超时未支付取消，也可能被核销。

这个可以根据产品需求处理，比如用户下单的优惠券，在取消订单时不退回，那可以直接修改成已使用状态。如果取消订单需要退还用户优惠券，那就不能改成已使用状态，可以考虑用一个中间态来表示下单未支付的情况-冻结，这个冻结只是中间随着订单状态转化而变化的状态，灵活程度更高。

### 二、优惠券业务现状


### 三、需求迁移设计


### 四、数据迁移


### 五、未来需求优化

### 六、思考

