### 一、计算机内存模型

#### 1.1 内存模型

![](https://raw.githubusercontent.com/zhchenme/java-memo/master/image/基础/java-memory-model-1)
图片来源：[Java Memory Model](http://tutorials.jenkov.com/java-concurrency/java-memory-model.html)

 - 寄存器（registers）：在 CPU 内部，用来存储指令、数据和地址等，是 CPU 可以读写的最快的存储器
 - CPU 缓存（cache）：高速缓冲存储器，在 CPU 内部，一般会分级（L1，L2，L3）
 - 主存（RAM）：一般我们所说的内存条
 - 外部存储器：硬盘（机械硬盘，固态硬盘）和磁盘是同一个意思，硬盘最常见的类型就是磁盘）、U 盘、光盘等

#### 1.2 CPU 读取硬盘数据流程

 1. CPU 将相关的命令和地址，通过系统总线和IO总线传递给磁盘，发起一个磁盘读
 2. 磁盘控制器将相关的地址解析，并通过IO总线与内存总线将数据传给内存
 3. 第2步完成之后，磁盘控制器向CPU发送一个中断信号，这时CPU就知道了，数据已经发送到内存了

#### 1.3 CPU 多节缓存

![](https://raw.githubusercontent.com/zhchenme/java-memo/master/image/基础/java-memory-model-3)
图片来源：[与程序员相关的CPU缓存知识](https://coolshell.cn/articles/20793.html)

### 二、Java 内存模型

#### 2.1 主内存与工作内存

![](https://raw.githubusercontent.com/zhchenme/java-memo/master/image/基础/java-memory-model-2)

Java 内存模型规定所有的变量都必须存储在主内存中，而每条线程都有自己的工作内存，线程的工作内存中保存了主内存中对象的副本，线程对变量的所有操作都必须在工作内存中进行，而不能直接操作主内存中的变量。

工作内存是线程私有的，而主内存是所有线程共享的部分。

#### 2.2 Java 内存模型与计算机内存模型之间的关系

![](https://raw.githubusercontent.com/zhchenme/java-memo/master/image/基础/java-memory-model-4)
图片来源：[Java Memory Model](http://tutorials.jenkov.com/java-concurrency/java-memory-model.html)

JVM 中所有的栈内存与对内存都在计算机中的 RAM 中，部分堆栈可能在 CPU 的缓存或者寄存器中。

### 三、并发问题

#### 3.1 原子性

#### 3.2 可见性

指当一个线程修改了共享变量的值，其他线程立即知道修改。

Java 内存模型通过变量修改后将值同步回主存，在变量读取前从主内存刷新变量的方式来实现可见性。Java 中能实现可见性的关键字有 `volatile`，`synchronized` 和 `final`



#### 3.3 有序性

### 参考：

《深入理解 Java 虚拟机》 周志明 著 <br>
[什么是内存（一）：存储器层次结构](https://www.cnblogs.com/yaoxiaowen/archive/2004/01/13/7805661.html)by eleven_yw
[为什么寄存器比内存快？](http://www.ruanyifeng.com/blog/2013/10/register.html) by 阮一峰 <br>
[CPU与硬盘关系的几点疑问？](https://www.zhihu.com/question/55954313) <br>
[与程序员相关的CPU缓存知识](https://coolshell.cn/articles/20793.html) <br> by 陈皓