### 一、Redis 主从复制

Redis 中可以通过命令 `SLAVEOF host port` 和配置 `slaveof` 配置项，让服务器（从服务器）复制另一个服务器（主服务器）上的数据，经过复制过后，从服务器与主服务器数据一致。

主从复制有以下几个优点：

 - 数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式
 - 故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余
 - 负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。

### 二、主从复制步骤

从服务器对主服务器的同步通过像主服务器发送 `PSYNC` 命令完成，下面是执行步骤：

 1. 从服务器像主服务器发送 `PSYNC` 命令
 2. 主服务器接收到 `PSYNC` 命令后执行 `BGSAVE` 命令在后台生成一个 RDB 文件，并使用一个缓冲区记录从现在开始执行的所有写命令
 3. RDB 文件生成后，主服务器将 RDB 文件发送给从服务器，从服务器接收到 RDB 后会载入该文件
 4. 主服务器将缓冲区记录的所有写命令发送给从服务器，从服务器执行完写命令后，数据库状态与主服务器保持一致
 
同步操作完成后，每当主服务器执行完一条写命令后，主服务器执行完后会将该命令发送给从服务器，从服务器执行完写命令后就又与主服务器保持一致了。

### 三、主从复制原理

复制分为完整重同步和部分重同步两种情况，都通过 `PSYNC` 命令实现：

- 完全重同步：完整重同步用于处理初次复制情况，

### 参考

《Redis 设计与实现》 黄建宏 著 <br>
[深入学习Redis（3）：主从复制](https://www.cnblogs.com/kismetv/p/9236731.html#t67) <br>