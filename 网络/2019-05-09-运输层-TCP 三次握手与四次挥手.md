### 一、TCP 三次握手

TCP 三次握手原理图：

![在这里插入图片描述](https://img-blog.csdnimg.cn/2019050911063512.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NvZGVqYXM=,size_16,color_FFFFFF,t_70)

TCP 是全双工通信，三次握手的主要目的是为了初始化客户与服务器的数据传输序列号。

假设运行在一台客户主机上的进程想与另一台服务器主机上的一个进程建立一条 TCP 连接，客户应用进程首先通知客户 TCP，它想建立一个与服务器上某个进程之间的连接。以下是三次握手过程的详细描述：

 1. 客户端的 TCP 首先向服务器端的 TCP 发送一个特殊的 TCP 报文段，该报文段中不包含任何应用层数据。但是在报文段的首部中的一个标志字段 SYN 会被置为 1。所以该报文段也被称为 SYN 报文段。除此之外，客户端会随机挑选一个初始序号，并将该序号放在该起始的 TCP 报文段的 seq 字段中。
 2. 当 SYN 报文段到达服务器主机，服务器会从该数据报中提取 TCP SYN 报文段，为该 TCP 连接分配 TCP 缓存和变量，并向该客户 TCP 发送允许连接的报文段。这个允许连接的报文段也不包含引用层数据。但是，它的首部却包含了 3 个重要的信息。首先，SYN 字段被置为 。其次，该 TCP 报文段首部的确认号字段被置为 client_isn+1。最后，服务器选择自己的初始序列号，并将其放置到 TCP 报文段首部的 seq 字段中。这个报文段也被称为 SYNACK 报文段。
 3. 在接收到 SYNACK 报文段后，客户也要给该连接分配缓存和变量。客户主机则向服务器发送另一个报文段；这最后一个报文段对服务器的允许连接的报文段进行了确认（ack=server_isn+1），并将发送方的 seq+1 作为新的序号。因为连接已经建立了，所以该 SYN 字段被置为 0。这一阶段的握手阶段可以在报文段负载中携带客户到服务器的数据。
 
PS：SYN 是 TCP 首部中的一个字段，用于表示建立连接。

当三次握手完成后，客户和服务区主机就可以相互发送包括数据的报文段了。在以后的每一个报文段中，SYN 比特都将被置为 0。

### 二、四次挥手

天下没有不散的宴席，对于 TCP 连接也是如此。参与一条 TCP 连接的两个进程任何一个都能终止该连接。当连接结束后，主机中的“资源”将被释放。

![在这里插入图片描述](https://img-blog.csdnimg.cn/20190509154731763.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2NvZGVqYXM=,size_16,color_FFFFFF,t_70)


 1. 客户进程发起一个关闭连接命令。这会引起客户 TCP 向服务器进程发送一个特殊的 TCP 报文段，即 FIN 比特被设置为 1。
 2. 当服务器接收到该报文段时，就向客户端返回一个确认报文段。
 3. 服务端发送确认报文段后会发送它自己的终止报文段。然后服务器发送它自己的终止报文段，其 FIN 比特被置为 1。
 4. 最后客户对这个服务器的终止报文段进行确认。
 
PS :FIN 也是 TCP 首部中的字段，用于表示关闭连接。