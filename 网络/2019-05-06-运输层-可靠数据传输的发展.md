rdt(reliable data transfer protocol).

### 一、可靠信道 rdt1.0

可靠信道是一种比较简单的方式，即底层信道完全是可靠的。

所有分组从发送方流向接受方，有了完全可靠的信道，接收端就不需要提供任何反馈信息给发送方，因为没有必要担心出现差错。但是需要注意的是接收方不能要求发送方数据发送的慢一些。

### 二、比特差错信道

可靠信道有一个严重的问题是：分组中的比特可能受损，即便提供了可靠信道，因此也不是严格意义上的可靠数据传输。

rdt2.0 原理是基于自动重传机制协议（atomic repeat request ARQ）提供可靠数据传输，ARQ 协议需要三种协议功能来处理比特差错的情况：

- 差错检测：方便接受方检测何时出现了比特差错（类比 UDP 校验和）
- 接受方反馈：接收方向发送方提供明确的反馈信息（ACK-1，NAK-0）
- 重传：接受方收到差错的分组时，发送方会重传该分组

当发送方已经发送了分组处于等待 ACK 或 NAK 状态时，它不能从上层获取更多的数据，这就意味着发送方不会发送新的分组，除非发送方确信接受方已经正确的接收当前分组。这种情况被称为停等（stop-and-wait）协议。

rdt2.0 看似已经没有问题了，但遗憾的是它有一个致命的缺陷：它么没有考虑 ACK 或 NAK 受损的可能性。解决这个问题的方法是在数据分组中添加一个新字段，让发送方对其数据进行分组编号，即将发送的数据分组的序号（sequence number）放在该字段上。这样接受方只需要检查序号即可确定接收到的分组是否为重传的分组。

协议 rdt2.1 使用了从接受方到发送方的肯定确认与否定确认。当接收到失序的分组时，接受方对所接收的分组发送一个肯定确认。如果收到受损的分组，则接受方发送一个否定确认。

rdt2.2 与 rdt2.1 的不同在于，接收方此时必须包括一个由 ACK 报文所确认的分组序号。

### 三、比特差错丢包信道 rdt3.0

除了发送比特受损外还需要考虑另外一个问题：底层信道丢包。

解决丢包的方案比较简单，让发送方检测和恢复丢包工作即可。但是发送方需要等待多久才能确定某些数据包丢失了呢？很明显需要等待的时间是发送方与接收方之间的一个往返时延加上接受方处理一个分组需要的时间。因此实践中采取的方法是让发送方明智的选择一个时间值，如果在这个时间内没有收到 ACK，则重传该分组。

为了实现基于事件的重传机制，需要一个倒计时计数器，在一个给定的时间量过期后，可中断发送方。

rdt3.0 是一个正确的协议，但是却存在很大的性能问题，核心性能就是它的停等协议。

一个分组从发送方到接收方，并由接收方返回反馈信息，中间往返时间内发送方都必须是等待的，就导致发送方的利用率（吞吐量）很低。

一个简单的解决方式是：不以停等方式运行，允许发送方发送多个分组而不需要等待确认。因为许多从发送方向接收方传输的分组可以看作是填充到一条流水线中，故这种技术也被称为流水线（pipilining）。流水线技术对可靠数据传输协议主要有以下几个影响：

- 必须增加序号范围
- 协议的发送方和接收方必须缓存多个分组

解决流水线差错恢复有两种方法：回退 N 步（GBN），也被称为滑动窗口协议，和选择重传（selective repeat SP）。

如何实现差错恢复，这就是滑动窗口要做的事情了。